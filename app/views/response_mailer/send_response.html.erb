<!DOCTYPE html>
<html>
  <head>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type' />
  </head>
  <body>
    <h1>Response to questionnaire - <%= @response.questionnaire.title %></h1>
    <p><%= @response.questionnaire.description %></p>
    <hr>
    <h3>Response from <%= @response.name %></h3>
    <% %w(address email phone age sex).each do |detail| %>
      <% val = @response.send(detail) %>
      <% if val %>
        <p><strong><%= detail.capitalize %>:</strong> <%= present(detail) %></p>
      <% end %>
    <% end %>
    <br>
    <% @response.answers.each_with_index do |answer, i| %>
      <p><strong>Q<%= i + 1 %>.</strong>
      <%= answer.question.blurb %></p>
      <p><strong>A<%= i + 1 %>.</strong>
      <% case answer.question.answer_type.to_sym %>
        <% when :single_line, :multi_line %>
          <%= answer.atext %>
        <% when :yes_no %>
          <%= answer.yes_no ? 'Yes' : 'No' %>
        <% when :true_false %>
          <%= answer.yes_no.to_s.humanize %>
        <% when :multiple_choice_single %>
          <%= answer.question.choices[answer.choice.to_i] %>
        <% when :multiple_choice_any %>
          <% if answer.choice.present? %>
            <%= answer.question.choices.values_at(*(JSON.parse(answer.choice).map {|n| n.to_i})).join(' &bull; ').html_safe %>
          <% else %>
            (No choices selected)
          <% end %>
        <% when :score %>
          <%= answer.choice.to_i %>
      <% end %></p>
    <% end %>
  </body>
</html>
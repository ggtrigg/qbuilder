Response to questionnaire - <%= @response.questionnaire.title %>
<%= @response.questionnaire.description.body.to_plain_text %>

Response from <%= @response.name %>

<% %w(address email phone age sex).each do |detail| %>
  <% val = @response.send(detail) %>
  <% if val %>
  <%= detail.capitalize %>: <%= present(detail) %>
  <% end %>
<% end %>

<% @response.answers.each_with_index do |answer, i| %>
  Q<%= i + 1 %>. <%= answer.question.blurb %>
  <% case answer.question.answer_type.to_sym %>
    <% when :single_line, :multi_line %>
      <%= answer.atext %>
    <% when :yes_no %>
      <%= answer.yes_no ? 'Yes' : 'No' %>
    <% when :true_false %>
      <%= answer.yes_no.to_s.humanize %>
    <% when :multiple_choice_single %>
      <%= answer.question.choices[answer.choice.to_i] %>
    <% when :multiple_choice_any %>
      <% if answer.choice.present? %>
        <%= answer.question.choices.values_at(*(JSON.parse(answer.choice).map {|n| n.to_i})).join(' &bull; ').html_safe %>
      <% else %>
        (No choices selected)
      <% end %>
    <% when :score %>
      <%= answer.choice.to_i %>
  <% end %>
<% end %>
